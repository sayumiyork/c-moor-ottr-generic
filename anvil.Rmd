
# (PART\*) Setting up on a cloud platform {-}

# Setting up on a cloud platform

Your class will use either AnVIL or SciServer as their cloud platform for accessing tutorial modules, data, and computational resources. Refer to the appropriate section for your class. **You do not have to sign up for both!**

# Join AnVIL

*The Genomic Data Science Analysis, Visualization, and Informatics Lab-space*

### Purpose

Your class will use the online platform **AnVIL** to do some access learning modules and do data analysis. The purpose of this assignment is to register for an AnVIL account, and clone the workspace appropriate for your class and research project

```{r, fig.align='center', out.width="100%", echo = FALSE, fig.alt= "Homepage for AnVIL, the platform where your class will run your analyses"}
ottrpal::include_slide("https://docs.google.com/presentation/d/1dI8-_iVqbkzNMf11M4dK85E8ZW3OyZECs_YwMKw5fhs/edit#slide=id.g3632cdae791_0_385")
```


### Learning Objectives

1. Create an account on AnVIL
1. Share your email address with your instructor
1. Clone the workspace for your specific research project

### Introduction

AnVIL (The Genomic Data Science **An**alysis, **V**isualization, and **I**nformatics **L**ab-space) is a platform created by the 
National Human Genome Research Institute (NHGRI) in collaboration with cloud computing platform providers like Google and Microsoft. Using AnVIL we you can access computing resources on the cloud through your browser without need for any fancy physical equipment. Through AnVIL you will also have access to all the software and data necessary to complete your research project. 


## Create an account on AnVIL

This video ([video](https://drive.google.com/file/d/1Fk8Ha-cpAuaXccnsppGXNbRPbIdS5hFR/view?usp=sharing))([slides](---)) show you how to create an AnVIL account, clone a workspace, run a module, and then close down your environment. 

1. Open [anvil.terra.bio](https://anvil.terra.bio/) in <mark> **Google Chrome** </mark>. Google Chrome is the only officially supported web browser for AnIVL.
    a. It is a good idea to bookmark this page so that you can easily access it throughout the course.
1. Click the hamburger icon (3 horizontal lines) in the top left corner of the screen 
1. Click "Sign in"
1. Click "Sign in with Google".
1. Sign in with a <mark>**Google associated email address**</mark> such as an institutional email that uses Gmail or a personal Gmail account. You must use a Google associated email address to gain access to Google Cloud computing resources. 
1. Follow all steps required to complete creating an account (ex. email verification of account)
1. Share the email you used to sign up for AnVIL with your instructor.

**Your instructor will add you to a billing project that will allow you to use computational resources on AnVIL. Until they do so, you will not be able to compute anything.** 

## Clone a workspace on AnVIL

1. While logged into AnVIL, using the hamburger icon in the top left corner of the screen, navigate to the workspaces page
1. Select the public tab
1. Search for the desired workspace. Your instructor will tell you which workspace to look for (miniCURE-RNA-seq or miniCURE-16S-Human_Gut).
1. Click on the more options icon on the right side of the desired workspace and click clone
1. Give the cloned workspace a unique name, such as by adding your initials or last name. All workspaces must have unique names; if someone has already taken the workspace name you initially wanted, please try a different name.
1. Confirm the billing project is the one your instructor has chosen.
1. The rest of the options should be left as is. Clone the workspace. It may take a few minutes to clone.

<mark>**You only have to clone the workspace once. From now on, use your cloned workspace.**</mark> After you clone the workspace you will automatically be directed to it. For all other times, your workspaces can be found using the hamburger icon in the top left.

```{r, fig.align='center', out.width="100%", echo = FALSE, fig.alt= "Settings for cloning a workspace on AnVIL. Adjust the fields shown above."}
ottrpal::include_slide("https://docs.google.com/presentation/d/1dI8-_iVqbkzNMf11M4dK85E8ZW3OyZECs_YwMKw5fhs/edit#slide=id.g3632cdae791_0_18")
```


# Running modules on AnVIL

When you open the workspace, you will be on the dashboard tab by default. The dashboard contains the instructions on how to use the workspace, links to C-MOOR websites, and the startup script.

1. <mark>**Copy the startup script**</mark>. Make sure there are no spaces before or after what you copy. This script is held in the original workspace everyone cloned. It does not have to be in your own workspace for it to work.
2. Click on the Environment Configuration button (cloud with thunderbolt)

```{r, fig.align='center', out.width="100%", echo = FALSE, fig.alt= "Starting an RStudio environment from the workspace dashboard."}
ottrpal::include_slide("https://docs.google.com/presentation/d/1dI8-_iVqbkzNMf11M4dK85E8ZW3OyZECs_YwMKw5fhs/edit#slide=id.g3632cdae791_0_87")
```

3. In the RStudio section, click Settings
4. In application configuration, select Legacy RStudio (R 4.4.1, Bioconductor 3.19, Python 3.10.12). 
5. In the <mark>**startup script field, paste the startup script**</mark>
6. Scroll to the bottom of the window and click “Create”. 

```{r, fig.align='center', out.width="100%", echo = FALSE, fig.alt= "Settings for the RStudio environment"}
ottrpal::include_slide("https://docs.google.com/presentation/d/1dI8-_iVqbkzNMf11M4dK85E8ZW3OyZECs_YwMKw5fhs/edit#slide=id.g3632cdae791_0_91")
```

It will take some time for the RStudio Environment to be created. You can keep track of the status of the environment based on the colored dot next to the RStudio icon. The dot will turn green when the environment is ready. While it is loading (blue), you cannot interact with it.

```{r, fig.align='center', out.width="100%", echo = FALSE, fig.alt= "The status of the RStudio Environment."}
ottrpal::include_slide("https://docs.google.com/presentation/d/1dI8-_iVqbkzNMf11M4dK85E8ZW3OyZECs_YwMKw5fhs/edit#slide=id.g3632cdae791_0_95")
```

7. When the environment is ready, use the Open RStudio button that will pop up. You can also access RStudio through the Analyses tab. If you hold down Ctrl as you click, you can open RStudio in a new window.

```{r, fig.align='center', out.width="100%", echo = FALSE, fig.alt= "The status of the RStudio Environment."}
ottrpal::include_slide("https://docs.google.com/presentation/d/1dI8-_iVqbkzNMf11M4dK85E8ZW3OyZECs_YwMKw5fhs/edit#slide=id.g3632cdae791_0_99")
```

8. Use the file explorer in RStudio to navigate to your module of choice. From the folder called cure-rnaseq, go to tutorials, and then the folder of the module you want.

```{r, fig.align='center', out.width="100%", echo = FALSE, fig.alt= "The status of the RStudio Environment."}
ottrpal::include_slide("https://docs.google.com/presentation/d/1dI8-_iVqbkzNMf11M4dK85E8ZW3OyZECs_YwMKw5fhs/edit#slide=id.g3632cdae791_0_103")
```

9. In the module’s directory, open the .Rmd file by double clicking its name.

```{r, fig.align='center', out.width="100%", echo = FALSE, fig.alt= "The status of the RStudio Environment."}
ottrpal::include_slide("https://docs.google.com/presentation/d/1dI8-_iVqbkzNMf11M4dK85E8ZW3OyZECs_YwMKw5fhs/edit#slide=id.g3632cdae791_0_107")
```

10. Click Run Document in the open .Rmd file

```{r, fig.align='center', out.width="100%", echo = FALSE, fig.alt= "The status of the RStudio Environment."}
ottrpal::include_slide("https://docs.google.com/presentation/d/1dI8-_iVqbkzNMf11M4dK85E8ZW3OyZECs_YwMKw5fhs/edit#slide=id.g3632cdae791_0_111")
```

```{r, echo = FALSE}
devtools::session_info()
```

## Closing out a session on AnVIL

1. On the right side of the screen, click the Cloud Environment button. This is the Cloud with the lighting symbol.
1. Under the RStudio section, click settings.
1. Scroll to the bottom of the new window and click delete environment.
1. Check <mark>**Delete everything, including the persistent disk or your instructor's billing account will incur costs for storage**</mark>. 

```{r, fig.align='center', out.width="100%", echo = FALSE, fig.alt= "The status of the RStudio Environment."}
ottrpal::include_slide("https://docs.google.com/presentation/d/1dI8-_iVqbkzNMf11M4dK85E8ZW3OyZECs_YwMKw5fhs/edit#slide=id.g3632cdae791_0_180")
```

### Footnotes

#### Contributions and Affiliations

- Sayumi York, Notre Dame University of Maryland

Last Revised: July 16, 2025
